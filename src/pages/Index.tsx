import { useState } from 'react';
import { Card } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import Icon from '@/components/ui/icon';

interface Choice {
  text: string;
  nextScene: number;
  obsessionChange?: number;
  trustChange?: number;
  independenceChange?: number;
}

interface Scene {
  id: number;
  text: string;
  choices: Choice[];
  character?: string;
  isEnding?: boolean;
}

interface Stats {
  obsession: number;
  trust: number;
  independence: number;
}

const storyData: Scene[] = [
  {
    id: 0,
    text: "Тебя зовут Капсаицин, и тебе 13 лет. Ты живёшь в величественном дворце посреди раскалённой пустыни с отцом — Бурнингом Спайсом, великим разрушителем. Его чёрные волосы до пола, мускулистое тело в жёлтых одеждах с красным поясом внушают трепет всему королевству. Но для тебя он просто отец... Хотя иногда его взгляд становится странным, а ревность пугающей.",
    character: "Капсаицин",
    choices: [
      { text: "Проснуться утром во дворце", nextScene: 1 }
    ]
  },
  {
    id: 1,
    text: "Ты просыпаешься в своих покоях. Жара пустыни уже чувствуется, несмотря на толстые стены. Сегодня должен прийти новый репетитор по истории. Ты очень ждёшь — наконец-то можно будет поговорить с кем-то кроме отца! Но вспоминаешь, как закончилось с предыдущими учителями... Отец всегда находил причину их изгнать.",
    character: "Капсаицин - Утро",
    choices: [
      { text: "Пойти к отцу за разрешением", nextScene: 2, obsessionChange: -5, trustChange: 10, independenceChange: -5 },
      { text: "Идти встречать репетитора самостоятельно", nextScene: 3, obsessionChange: 10, trustChange: -10, independenceChange: 10 }
    ]
  },
  {
    id: 2,
    text: "Ты находишь отца в тронном зале. Его длинные волосы рассыпаны по спине, мускулы напряжены. Он поворачивается к тебе, и его взгляд смягчается. 'Мой сын... Ты хочешь что-то спросить?' Ты чувствуешь, как он всегда знает, когда ты хочешь чего-то, что может ему не понравиться.",
    character: "Капсаицин - Диалог с отцом",
    choices: [
      { text: "Спросить про репетитора осторожно", nextScene: 4, obsessionChange: 5, trustChange: 5 },
      { text: "Попросить разрешения гулять одному", nextScene: 5, obsessionChange: 15, independenceChange: 5 }
    ]
  },
  {
    id: 3,
    text: "Ты решаешь идти самостоятельно. Свобода принимать решения — это так необычно! Но когда ты выходишь в коридор, чувствуешь взгляд на спине. Оборачиваешься — отец стоит в тени колонны. Его лицо непроницаемо, но руки сжаты в кулаки. 'Куда ты идёшь без меня, Капсаицин?'",
    character: "Капсаицин - Попытка независимости",
    choices: [
      { text: "Сказать правду про репетитора", nextScene: 6, trustChange: 10, independenceChange: 5 },
      { text: "Соврать, что просто гулял", nextScene: 7, obsessionChange: 5, trustChange: -15 }
    ]
  },
  {
    id: 4,
    text: "'Отец... Сегодня должен прийти новый репетитор. По истории. Я хочу учиться...' Ты видишь, как лицо отца темнеет. 'Репетитор? Зачем тебе чужие люди? Я могу научить тебя всему!' Его голос становится громче. Ты знаешь этот тон — скоро начнётся.",
    character: "Капсаицин - Просьба",
    choices: [
      { text: "Настаивать на своём", nextScene: 8, obsessionChange: 10, independenceChange: 10 },
      { text: "Согласиться с отцом", nextScene: 9, obsessionChange: -10, trustChange: 5, independenceChange: -15 }
    ]
  },
  {
    id: 5,
    text: "'Отец, можно мне погулять во дворце? Одному?' Вопрос повисает в воздухе. Спайс медленно встаёт, его огромная фигура возвышается над тобой. 'Одному? Почему ты хочешь быть без меня? Я тебе не нравлюсь?' В его голосе — обида и что-то ещё. Что-то пугающее.",
    character: "Капсаицин - Просьба о свободе",
    choices: [
      { text: "Объяснить, что просто хочется свободы", nextScene: 10, obsessionChange: 10, independenceChange: 10 },
      { text: "Отказаться от идеи", nextScene: 11, obsessionChange: -5, independenceChange: -10 }
    ]
  },
  {
    id: 6,
    text: "'Я иду встречать репетитора. Мне нужно учиться.' Ты стараешься говорить уверенно, но голос дрожит. Отец подходит ближе, его длинные волосы почти касаются тебя. 'Репетитор...' — его голос похож на рычание. 'Хорошо. Я пойду с тобой. Я должен... проверить этого человека.'",
    character: "Капсаицин - Правда",
    choices: [
      { text: "Согласиться, чтобы не злить отца", nextScene: 12, obsessionChange: 5, trustChange: 5 },
      { text: "Попросить встретить учителя одному", nextScene: 13, obsessionChange: 15, independenceChange: 15 }
    ]
  },
  {
    id: 7,
    text: "'Я... просто гулял, отец.' Ложь даётся тяжело. Спайс прищуривается. Он всегда чувствует, когда ты врёшь. 'Просто гулял? Без меня?' Он медленно идёт к тебе. 'Ты знаешь, что я не люблю, когда ты от меня что-то скрываешь, мой сын.' Его рука ложится тебе на плечо — тяжёлая, горячая.",
    character: "Капсаицин - Ложь",
    choices: [
      { text: "Признаться в обмане", nextScene: 14, obsessionChange: -5, trustChange: 15 },
      { text: "Продолжать врать", nextScene: 15, obsessionChange: 10, trustChange: -20 }
    ]
  },
  {
    id: 8,
    text: "'Отец, пожалуйста! Мне нужно образование!' Твой голос звучит отчаянно. Спайс смотрит на тебя долго, очень долго. Наконец кивает. 'Хорошо. Но я буду присутствовать на всех занятиях. Я должен знать, чему тебя учат.' Это компромисс, но ты понимаешь — это лучшее, чего можно добиться.",
    character: "Капсаицин - Маленькая победа",
    choices: [
      { text: "Встретить репетитора с отцом", nextScene: 12 }
    ]
  },
  {
    id: 9,
    text: "'Ты прав, отец. Прости.' Ты опускаешь голову. Спайс сразу смягчается, обнимает тебя. 'Вот и хорошо, мой мальчик. Зачем тебе чужие люди? У тебя есть я. Только я.' Его объятие крепкое, почти удушающее. Ты чувствуешь себя в клетке из любви.",
    character: "Капсаицин - Подчинение",
    choices: [
      { text: "Попытаться вырваться позже", nextScene: 16 },
      { text: "Смириться с ситуацией", nextScene: 22 }
    ]
  },
  {
    id: 10,
    text: "'Отец, я не хочу быть без тебя. Просто... Иногда мне нужно побыть наедине с собой. Подумать.' Ты стараешься объяснить максимально мягко. Спайс хмурится. 'Подумать? О чём? О том, как сбежать от меня?' Паранойя в его голосе очевидна.",
    character: "Капсаицин - Объяснение",
    choices: [
      { text: "Успокоить отца", nextScene: 17, obsessionChange: -10, trustChange: 15 },
      { text: "Разозлиться на недоверие", nextScene: 21, obsessionChange: 15, independenceChange: 10 }
    ]
  },
  {
    id: 11,
    text: "'Нет, отец. Мне не нужно. Прости.' Ты отступаешь. Спайс улыбается — довольная, собственническая улыбка. 'Вот и хорошо. Мы будем гулять вместе. Как всегда.' Он берёт тебя за руку, и ты чувствуешь себя маленьким ребёнком, хотя тебе уже 13.",
    character: "Капсаицин - Отказ",
    choices: [
      { text: "Идти гулять с отцом", nextScene: 18 },
      { text: "Уйти в свои покои", nextScene: 16 }
    ]
  },
  {
    id: 12,
    text: "Вы вместе встречаете репетитора — пожилого учёного. Ты взволнован возможностью учиться, но отец сидит рядом, его взгляд не отрывается от учителя. Каждое слово, каждый жест отслеживается. Репетитор явно нервничает под таким надзором. Ты тоже не можешь расслабиться.",
    character: "Капсаицин - Урок под надзором",
    choices: [
      { text: "Попросить отца оставить вас наедине", nextScene: 24 },
      { text: "Продолжать урок в такой обстановке", nextScene: 23 },
      { text: "Задать отцу вопросы о его прошлом", nextScene: 39 }
    ]
  },
  {
    id: 13,
    text: "'Отец, пожалуйста... Позволь мне встретить его одному. Я уже не маленький.' Твои слова действуют как катализатор. Лицо Спайса искажается. 'НЕ МАЛЕНЬКИЙ?! Ты МОЙ сын! Ты всегда будешь под моей защитой!' Он хватает тебя за плечи. Больно.",
    character: "Капсаицин - Вспышка ярости отца",
    choices: [
      { text: "Заплакать от боли", nextScene: 20, obsessionChange: -15, trustChange: 5 },
      { text: "Попытаться вырваться", nextScene: 21, obsessionChange: 20, independenceChange: 15 }
    ]
  },
  {
    id: 14,
    text: "'Прости, отец. Ты прав. Я хотел встретить репетитора. Но я не должен был скрывать это.' Ты признаёшься, надеясь на понимание. Спайс вздыхает, его хватка ослабевает. 'Я прощаю тебя, сын. Но не скрывай больше ничего от меня. Никогда.' Его голос — мягкий, но в нём скрыта угроза.",
    character: "Капсаицин - Признание",
    choices: [
      { text: "Встретить репетитора вместе", nextScene: 12 }
    ]
  },
  {
    id: 15,
    text: "'Просто... просто гулял, отец.' Ты упорствуешь. Спайс резко дёргает тебя к себе. Его лицо в сантиметрах от твоего. 'Не лги мне. НИКОГДА не лги мне. Я всё вижу. Я всё знаю. Ты понял?' Его дыхание горячее, глаза безумны. Ты кивок, не в силах говорить от страха.",
    character: "Капсаицин - Разоблачение",
    choices: [
      { text: "Признаться в правде", nextScene: 14 },
      { text: "Убежать в свои покои", nextScene: 16 }
    ]
  },
  {
    id: 16,
    text: "Ты убегаешь в свои покои и запираешься. Слёзы текут по щекам. Почему отец не может просто... отпустить? За дверью слышны тяжёлые шаги. 'Капсаицин... Сын... Открой дверь. Прости меня.' Голос отца звучит сломленно. Но ты боишься открывать.",
    character: "Капсаицин - Убежище",
    choices: [
      { text: "Открыть дверь", nextScene: 26 },
      { text: "Остаться в комнате до утра", nextScene: 25 }
    ]
  },
  {
    id: 17,
    text: "'Отец, я люблю тебя. Я никогда не сбегу. Но мне нужно немного пространства.' Ты обнимаешь его, чувствуя, как напряжённые мускулы медленно расслабляются. 'Обещай мне...' — шепчет он. 'Обещаю, отец.' Ты не уверен, что сдержишь это обещание.",
    character: "Капсаицин - Компромисс",
    choices: [
      { text: "Попросить немного свободы", nextScene: 30, obsessionChange: 10, independenceChange: 15 },
      { text: "Остаться с отцом", nextScene: 27, obsessionChange: -10, independenceChange: -10 }
    ]
  },
  {
    id: 18,
    text: "Вы гуляете по дворцу вместе. Отец держит тебя за руку, рассказывает истории о своих победах. Ты слушаешь, но мысли где-то далеко. Ты мечтаешь о свободе, о друзьях, о нормальной жизни. Но всё, что у тебя есть — это позолоченная клетка и любовь-одержимость.",
    character: "Капсаицин - Прогулка",
    choices: [
      { text: "Попытаться сбежать позже", nextScene: 38 },
      { text: "Принять свою судьбу", nextScene: 27 }
    ]
  },
  {
    id: 13,
    text: "Капсаицин замолкает, его глаза наполняются слезами. Спайс видит страх в глазах сына — и это разбивает его сердце. Он опускается на колени, его длинные волосы рассыпаются по полу: 'Прости... Я просто... Я не могу тебя потерять. Ты всё, что у меня есть.' Его голос ломается.",
    character: "Момент слабости",
    choices: [
      { text: "Плохая концовка: Изоляция", nextScene: 19 },
      { text: "Капсаицин обнимает отца", nextScene: 20 }
    ]
  },
  {
    id: 14,
    text: "Капсаицин осторожно подходит к отцу и обнимает его. 'Отец... Я никогда не уйду от тебя. Но мне нужны друзья, учителя... Я не могу жить только с тобой.' Спайс обнимает сына так крепко, что мальчику больно. 'Нет... Нет, ты не понимаешь... Они все предатели...'",
    character: "Попытка диалога",
    choices: [
      { text: "Настаивать на своей независимости", nextScene: 21 },
      { text: "Подчиниться воле отца", nextScene: 22 }
    ]
  },
  {
    id: 15,
    text: "Репетитор остаётся, но теперь Спайс всегда присутствует на занятиях. Он сидит в углу, его взгляд не отрывается от учителя. Каждое слово, каждый жест анализируется. Репетитор нервничает, Капсаицин чувствует себя неловко. Атмосфера давит...",
    character: "Напряжённые уроки",
    choices: [
      { text: "Продолжать так жить", nextScene: 23 },
      { text: "Попросить отца уйти", nextScene: 24 }
    ]
  },
  {
    id: 16,
    text: "Капсаицин убегает в свои покои и запирается. Он плачет от страха и непонимания. За дверью слышны шаги — Спайс ходит туда-сюда всю ночь. Иногда он тихо говорит: 'Прости... Прости, сын мой...' Но утром ревность вернётся снова. Это замкнутый круг.",
    character: "Одиночество",
    choices: [
      { text: "Плохая концовка: Золотая клетка", nextScene: 25 },
      { text: "Попытаться поговорить утром", nextScene: 26 }
    ]
  },
  {
    id: 17,
    text: "Капсаицин не убегает. Он остаётся рядом с отцом, видя его боль. 'Отец... Я здесь. Я с тобой.' Спайс обнимает сына, его огромные мускулистые руки дрожат. 'Обещай мне... Обещай, что никогда не покинешь меня.' В его голосе — тысячелетия одиночества и страха.",
    character: "Близость",
    choices: [
      { text: "Обещать остаться навсегда", nextScene: 27 },
      { text: "Сказать правду о своих чувствах", nextScene: 28 }
    ]
  },
  {
    id: 18,
    text: "Спайс сдерживается. Он не вмешивается, но каждая секунда — пытка. Он видит, как Капсаицин счастлив с кем-то другим. Возвращается в свои покои и разрушает половину мебели в ярости. Его длинные волосы в беспорядке, мускулы напряжены до предела. Он не может так больше...",
    character: "Внутренняя борьба",
    choices: [
      { text: "Плохая концовка: Взрыв ярости", nextScene: 29 },
      { text: "Попытаться измениться", nextScene: 30 }
    ]
  },
  {
    id: 19,
    text: "С того дня Капсаицин больше не видит никого, кроме отца. Все слуги, учителя, даже стражи изгнаны или казнены. Дворец становится тюрьмой для двоих. Спайс счастлив — сын принадлежит только ему. Но в глазах Капсаицина гаснет свет. Он превращается в тень, живущую в золотой клетке...",
    character: "ПЛОХАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 20,
    text: "Капсаицин обнимает отца. Оба плачут. Это момент истины — Спайс понимает, что его ревность разрушает единственного, кого он любит. 'Я постараюсь... Я постараюсь быть лучше,' — шепчет он. Путь будет долгим, но появилась надежда...",
    character: "Момент надежды",
    choices: [
      { text: "Хорошая концовка: Путь к исцелению", nextScene: 31 }
    ]
  },
  {
    id: 21,
    text: "'Отец, я люблю тебя, но так жить нельзя!' — кричит Капсаицин. Спайс отступает, его глаза расширяются от боли. 'Значит... Ты тоже хочешь меня покинуть...' Он медленно встаёт. Его лицо становится каменным. Ревность превращается в гнев. В ярость. В разрушение...",
    character: "Точка невозврата",
    choices: [
      { text: "Плохая концовка: Разрушение", nextScene: 32 }
    ]
  },
  {
    id: 22,
    text: "Капсаицин опускает голову. 'Хорошо, отец... Как скажешь.' Спайс улыбается — триумф ревности. С этого дня Капсаицин живёт под полным контролем. Каждый шаг, каждое слово под надзором. Любовь превращается в собственничество. Сын становится прекрасной игрушкой в руках одержимого правителя...",
    character: "ПЛОХАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 23,
    text: "Месяцы проходят в такой атмосфере. Репетитор в конце концов не выдерживает напряжения и сбегает. Капсаицин снова остаётся один на один с отцом. Спайс доволен. 'Видишь? Все уходят. Остаюсь только я. Только я люблю тебя по-настоящему.' Капсаицин начинает верить в эти слова...",
    character: "Медленное разрушение",
    choices: [
      { text: "Плохая концовка: Промывка мозгов", nextScene: 33 }
    ]
  },
  {
    id: 24,
    text: "'Отец, пожалуйста, уйди. Мне нужно учиться в нормальной обстановке.' Спайс замирает. Его просят уйти. ЕГО. Великого разрушителя. Его собственный сын просит уйти. Ревность взрывается ядерным грибом. 'Значит, он тебе важнее, чем я?!' — рычит он, хватая Капсаицина за плечи...",
    character: "Вспышка ревности",
    choices: [
      { text: "Плохая концовка: Насилие", nextScene: 34 },
      { text: "Спайс останавливает себя в последний момент", nextScene: 35 }
    ]
  },
  {
    id: 25,
    text: "Годы проходят. Капсаицин больше не пытается сопротивляться. Он живёт в роскошных покоях, но это золотая клетка. Спайс проводит с ним каждую минуту. Ревность стала нормой. Любовь превратилась в одержимость. Капсаицин больше не улыбается. Он просто существует...",
    character: "ПЛОХАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 26,
    text: "Утром Капсаицин открывает дверь. Спайс сидит прямо на полу у входа, его длинные волосы рассыпаны вокруг. Он не спал всю ночь. 'Отец...' — 'Прости меня,' — шепчет Спайс. 'Я чудовище. Но я не знаю, как иначе...' В его глазах — настоящая боль.",
    character: "Утреннее раскаяние",
    choices: [
      { text: "Предложить вместе найти решение", nextScene: 36 },
      { text: "Продолжать как прежде", nextScene: 22 }
    ]
  },
  {
    id: 27,
    text: "'Я обещаю, отец. Я останусь с тобой навсегда.' Спайс прижимает сына к себе. Это обещание становится цепью. Годы проходят, Капсаицин взрослеет, но никогда не покидает дворец. Он отказывается от своей жизни ради отца. Это любовь? Или жертва? Граница размыта...",
    character: "НЕЙТРАЛЬНАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 28,
    text: "'Отец, я люблю тебя. Но любовь не означает владение. Я твой сын, но я также отдельный человек. Мне нужно пространство, чтобы расти.' Спайс слушает. Каждое слово — как удар мечом. Но он СЛУШАЕТ. Впервые за тысячи лет он действительно слышит кого-то...",
    character: "Момент истины",
    choices: [
      { text: "Хорошая концовка: Принятие", nextScene: 37 }
    ]
  },
  {
    id: 29,
    text: "Ночью Спайс врывается в покои слуги. То, что происходит дальше, не стоит описывать. На следующее утро все во дворце знают — никто не смеет приближаться к Капсаицину. Мальчик становится неприкасаемым. Изолированным. Одиноким. Спайс уничтожил всё вокруг своего сына во имя 'любви'...",
    character: "ПЛОХАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 30,
    text: "Спайс смотрит на себя в зеркало. Его отражение — чудовище. Не снаружи, а внутри. 'Что я делаю со своим сыном?' — впервые за столетия он задаёт себе этот вопрос. Изменения не придут мгновенно. Но осознание проблемы — первый шаг...",
    character: "Осознание",
    choices: [
      { text: "Хорошая концовка: Путь к исцелению", nextScene: 31 }
    ]
  },
  {
    id: 31,
    text: "Прошло несколько лет. Спайс всё ещё ревнив, всё ещё собственник. Но теперь он борется с этим. Капсаицин может видеться с учителями, гулять с друзьями. Иногда Спайс срывается, но каждый раз просит прощения и старается лучше. Это не идеальная семья. Но это семья, которая исцеляется. Вместе.",
    character: "ХОРОШАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 32,
    text: "Ревность Спайса превращается в ярость. Он разрушает всё — дворец, королевство, даже пустыню вокруг. Капсаицин смотрит на отца с ужасом. 'Отец, остановись!' Но слишком поздно. Великий разрушитель уничтожает всё, включая последний шанс на любовь. Когда ярость проходит, Спайс остаётся один среди руин...",
    character: "САМАЯ ПЛОХАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 33,
    text: "Капсаицин начинает повторять слова отца: 'Никому нельзя доверять. Только отец меня любит. Только отец не предаст.' Спайс триумфует — сын теперь думает так же, как он. Но это победа? Или трагедия? Два одиноких человека, запертые в тюрьме паранойи, которую они сами построили...",
    character: "ПЛОХАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 34,
    text: "Спайс теряет контроль. Он причиняет боль собственному сыну в порыве ревности. Когда он приходит в себя, Капсаицин лежит на полу, плачет. Спайс понимает — он стал именно тем монстром, которым его считают. Он разрушил не только королевства, но и единственную настоящую связь в своей жизни...",
    character: "САМАЯ ПЛОХАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 35,
    text: "Спайс останавливается. Его руки дрожат в сантиметрах от Капсаицина. 'Нет... Нет, не это...' Он отступает, его огромное тело сотрясается от рыданий. 'Я чуть не... Боги, что я делаю?' Капсаицин смотрит на отца — и видит не монстра, а сломленного человека...",
    character: "Момент осознания",
    choices: [
      { text: "Хорошая концовка: Путь к исцелению", nextScene: 31 },
      { text: "Отдалиться от отца навсегда", nextScene: 38 }
    ]
  },
  {
    id: 36,
    text: "'Отец, давай вместе найдём способ. Ты боишься потерять меня, а я боюсь потерять тебя в твоей ярости. Но мы можем найти баланс.' Спайс смотрит на сына — такого мудрого для своих лет. 'Ты... Ты готов помочь мне?' — 'Всегда, отец. Всегда.'",
    character: "Союз",
    choices: [
      { text: "Хорошая концовка: Путь к исцелению", nextScene: 31 }
    ]
  },
  {
    id: 37,
    text: "Спайс закрывает глаза. Слова сына эхом отдаются в его душе. Медленно, очень медленно, он кивает. 'Научи меня... Научи меня, как любить правильно.' Капсаицин обнимает отца. Это долгий путь. Тысячи лет боли не исчезнут за день. Но они идут по нему вместе. И это уже победа.",
    character: "ЛУЧШАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 38,
    text: "Капсаицин понимает — он не может спасти отца. Он может только спасти себя. Однажды ночью он сбегает из дворца. Спайс находит пустую комнату и записку: 'Прости, отец. Я люблю тебя. Но я не могу жить в твоей клетке.' Великий разрушитель падает на колени. Он потерял единственное, что имело значение...",
    character: "ГОРЬКАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 39,
    text: "Ты решаешь воспользоваться моментом. 'Отец, расскажи мне о своём прошлом. Почему ты стал таким... каким ты есть?' Репетитор замолкает, явно облегчённый паузой. Спайс смотрит на тебя долго, в его глазах мелькает боль. 'Ты действительно хочешь знать?'",
    character: "Капсаицин - Вопросы отцу",
    choices: [
      { text: "Да, я хочу понять тебя", nextScene: 40, trustChange: 15, obsessionChange: -5 },
      { text: "Спросить, почему он так ревнует", nextScene: 41, obsessionChange: 10 },
      { text: "Спросить про его силу и волосы", nextScene: 42, trustChange: 10 }
    ]
  },
  {
    id: 40,
    text: "'Когда-то давно я был защитником. Я спасал слабых, верил в добро.' Голос отца становится тише. 'Но те, кого я спас, предали меня. Использовали мою доброту как слабость. Я потерял всё... И поклялся никогда больше не доверять никому.' Он смотрит на тебя. 'Кроме тебя. Только ты не предашь меня, правда?'",
    character: "Капсаицин - История предательства",
    choices: [
      { text: "Обещать никогда не предать", nextScene: 43, obsessionChange: -10, trustChange: 20, independenceChange: -15 },
      { text: "Сказать, что не все люди одинаковы", nextScene: 44, obsessionChange: 5, independenceChange: 10 }
    ]
  },
  {
    id: 41,
    text: "'Отец, почему ты так ревнуешь? Почему не можешь позволить мне общаться с другими?' Ты задаёшь вопрос осторожно. Лицо Спайса темнеет. 'Потому что ты прекрасен. Слишком прекрасен.' Его взгляд скользит по твоему телу, задерживаясь слишком долго. 'Все хотят тебя забрать. Я вижу, как они на тебя смотрят. Но ты МОЙ.'",
    character: "Капсаицин - Откровение",
    choices: [
      { text: "Смутиться от его слов", nextScene: 45, obsessionChange: 15 },
      { text: "Спросить, что он имеет в виду", nextScene: 46, obsessionChange: 10 }
    ]
  },
  {
    id: 42,
    text: "'Отец, расскажи про свои волосы и силу. Почему длинные волосы — это признак силы?' Спайс гордо расправляет плечи, его мускулы играют под кожей. 'Длинные волосы — символ того, что никто не смог меня победить. Каждый сантиметр — это доказательство моей власти.' Он касается твоих волос. 'Когда-нибудь и у тебя будут такие. Ты станешь таким же сильным.'",
    character: "Капсаицин - О силе",
    choices: [
      { text: "Я хочу быть сильным, как ты", nextScene: 47, trustChange: 15, obsessionChange: -10 },
      { text: "Я хочу быть добрым, а не сильным", nextScene: 48, independenceChange: 15 }
    ]
  },
  {
    id: 43,
    text: "'Я никогда не предам тебя, отец. Обещаю.' Слова срываются с твоих губ автоматически. Спайс притягивает тебя в объятия. 'Я знал. Я всегда знал, что ты особенный.' Его дыхание горячее у твоего уха. 'Ты единственный, кто действительно любит меня.' Ты чувствуешь себя связанным этим обещанием навсегда.",
    character: "Капсаицин - Обещание",
    choices: [
      { text: "Вернуться к урокам", nextScene: 23 },
      { text: "Попросить пойти на ужин", nextScene: 49 }
    ]
  },
  {
    id: 44,
    text: "'Но не все люди плохие, отец. Не все предатели.' Твои слова звучат робко. Спайс хмурится. 'Ты слишком молод, чтобы понимать. Все они рано или поздно покажут свою истинную природу.' Он встаёт. 'Довольно на сегодня. Урок окончен.' Репетитор спешит уйти, явно испуганный.",
    character: "Капсаицин - Несогласие",
    choices: [
      { text: "Извиниться перед отцом", nextScene: 50 },
      { text: "Остаться при своём мнении", nextScene: 51 }
    ]
  },
  {
    id: 45,
    text: "Твои щёки краснеют от его слов. 'Отец... Что ты говоришь?' Спайс медленно приближается, его огромная фигура нависает над тобой. 'Я говорю правду, Капсаицин. Ты красив. Даже слишком. Иногда я смотрю на тебя и...' Он останавливается, сжимая кулаки. 'Ты не понимаешь, как тяжело контролировать себя.'",
    character: "Капсаицин - Смущение",
    choices: [
      { text: "Отстраниться от отца", nextScene: 52, obsessionChange: 20, independenceChange: 15 },
      { text: "Спросить, что он чувствует", nextScene: 53, obsessionChange: 15 }
    ]
  },
  {
    id: 46,
    text: "'Что ты имеешь в виду, отец?' Ты смотришь на него с непониманием. Спайс проводит рукой по лицу. 'Ты ещё слишком молод. Но однажды ты поймёшь... Мои чувства к тебе не совсем... отцовские.' Его признание повисает в воздухе. Репетитор выглядит крайне неловко и пытается незаметно уйти.",
    character: "Капсаицин - Непонимание",
    choices: [
      { text: "Попросить объяснить подробнее", nextScene: 54 },
      { text: "Сделать вид, что не услышал", nextScene: 55 }
    ]
  },
  {
    id: 47,
    text: "'Я тоже хочу быть сильным! Научи меня, отец!' Твои глаза горят энтузиазмом. Лицо Спайса озаряется гордостью. 'Конечно, мой сын. Я научу тебя всему. Ты будешь великим воином.' Он обнимает тебя. 'Мы будем правит��� вместе. Навсегда.'",
    character: "Капсаицин - Амбиции",
    choices: [
      { text: "Начать тренировки", nextScene: 56 },
      { text: "Сначала поужинать", nextScene: 49 }
    ]
  },
  {
    id: 48,
    text: "'Я хочу быть добрым, отец. Как ты был когда-то.' Слова вырываются прежде, чем ты успеваешь их обдумать. Спайс замирает. Его лицо искажается болью. 'Доброта убьёт тебя, Капсаицин. Как чуть не убила меня.' Он поворачивается к окну. 'Мир жесток. Только сила имеет значение.'",
    character: "Капсаицин - Идеализм",
    choices: [
      { text: "Попытаться переубедить его", nextScene: 57 },
      { text: "Промолчать", nextScene: 58 }
    ]
  },
  {
    id: 49,
    text: "Вы идёте в пиршественный зал. Огромный стол ломится от еды — жареное мясо, дичь, целые туши. Спайс набрасывается на еду с невероятным аппетитом. Он рвёт мясо руками, жир стекает по его мускулистым рукам. 'Ешь, сын. Тебе нужны силы.' Ты смотришь на маленькую порцию перед собой — тебе редко хочется много есть.",
    character: "Капсаицин - Пир",
    choices: [
      { text: "Попытаться съесть больше", nextScene: 59, obsessionChange: -5 },
      { text: "Сказать, что не голоден", nextScene: 60, obsessionChange: 10, independenceChange: 5 }
    ]
  },
  {
    id: 50,
    text: "'Прости, отец. Я не должен был спорить.' Ты опускаешь голову покорно. Спайс гладит тебя по волосам. 'Вот и хорошо. Не забывай, кто здесь главный.' Его прикосновение нежное, но ты чувствуешь угрозу в его словах. Вечером он приглашает тебя на ужин, чтобы 'загладить' конфликт.",
    character: "Капсаицин - Извинение",
    choices: [
      { text: "Пойти на ужин", nextScene: 49 }
    ]
  },
  {
    id: 51,
    text: "'Я всё равно так думаю, отец.' Твоё упрямство удивляет даже тебя самого. Лицо Спайса краснеет от гнева. 'Значит, тебе нужен урок.' Он хватает тебя за запястье и тащит в тренировочный зал. 'Посмотрим, как долго продержится твоя доброта, когда ты столкнёшься с реальностью.'",
    character: "Капсаицин - Упрямство",
    choices: [
      { text: "Принять наказание", nextScene: 61 },
      { text: "Попытаться сопротивляться", nextScene: 62 }
    ]
  },
  {
    id: 52,
    text: "Ты отступаешь на шаг назад. 'Отец... Это неправильно.' Спайс останавливается, его лицо искажается болью и гневом одновременно. 'НЕПРАВИЛЬНО? Ты отвергаешь меня?!' Его голос эхом разносится по залу. 'После всего, что я для тебя сделал!' Он разворачивается и уходит, оставляя тебя в смятении.",
    character: "Капсаицин - Отторжение",
    choices: [
      { text: "Последовать за ним", nextScene: 63 },
      { text: "Остаться и обдумать ситуацию", nextScene: 64 }
    ]
  },
  {
    id: 53,
    text: "'Что ты чувствуешь, отец?' Ты смотришь на него с искренним любопытством. Спайс опускается на колени перед тобой, чтобы быть на одном уровне. 'Я чувствую... желание. Собственничество. Одержимость.' Его рука касается твоей щеки. 'Ты слишком молод, чтобы понять. Но я хочу владеть тобой полностью. Душой и телом.'",
    character: "Капсаицин - Откровенный разговор",
    choices: [
      { text: "Я не понимаю...", nextScene: 65 },
      { text: "Это пугает меня", nextScene: 66 }
    ]
  },
  {
    id: 54,
    text: "'Объясни мне, отец. Я хочу понять.' Ты смотришь на него с детской наивностью. Спайс стонет, закрывая лицо руками. 'Нет... Не сейчас. Ты слишком юн.' Он резко встаёт. 'Мне нужно... Пойдём поужинаем.' Он явно пытается сменить тему, борясь с чем-то внутри себя.",
    character: "Капсаицин - Невинность",
    choices: [
      { text: "Пойти на ужин", nextScene: 49 }
    ]
  },
  {
    id: 55,
    text: "Ты делаешь вид, что не услышал этих слов. Может, так будет лучше. Репетитор быстро собирает свои вещи и убегает при первой возможности. Остаётесь вы вдвоём. Спайс смотрит на тебя с неразгаданным выражением. 'Пойдём. Я голоден.' Он ведёт тебя в пиршественный зал.",
    character: "Капсаицин - Игнорирование",
    choices: [
      { text: "Следовать за отцом", nextScene: 49 }
    ]
  },
  {
    id: 56,
    text: "Спайс ведёт тебя в тренировочный зал. Он показывает тебе базовые стойки и удары. Его огромные руки направляют твои движения. Во время тренировки ты случайно царапаешь руку о деревянное оружие — маленькая царапина, несколько капель крови. Спайс видит это.",
    character: "Капсаицин - Тренировка",
    choices: [
      { text: "Продолжить тренировку", nextScene: 67, independenceChange: 10 },
      { text: "Показать отцу рану", nextScene: 68, obsessionChange: 15 }
    ]
  },
  {
    id: 57,
    text: "'Но отец, если все будут жестокими, мир станет ещё хуже! Кто-то должен оставаться добрым!' Твоя страсть удивляет Спайса. Он смотрит на тебя долго, в его глазах мелькает что-то похожее на ностальгию. 'Ты напоминаешь мне... меня самого. Тысячи лет назад.' Он вздыхает. 'Посмотрим, как долго это продлится.'",
    character: "Капсаицин - Убеждение",
    choices: [
      { text: "Я докажу тебе!", nextScene: 69 },
      { text: "Обнять отца", nextScene: 70 }
    ]
  },
  {
    id: 58,
    text: "Ты молчишь, не зная, что сказать. Спайс оборачивается, видит твоё растерянное лицо. Его выражение смягчается. 'Прости. Я не должен был срываться на тебя.' Он протягивает руку. 'Пойдём поужинаем. Я голоден, а ты выглядишь измученным.'",
    character: "Капсаицин - Молчание",
    choices: [
      { text: "Взять его руку", nextScene: 49 }
    ]
  },
  {
    id: 59,
    text: "Ты пытаешься съесть больше, чтобы угодить отцу. Но после нескольких кусков тебя начинает тошнить. Спайс замечает. 'Что такое? Еда плохая?' Его тон обеспокоенный. 'Нет, отец... Я просто... не могу много есть.' Спайс хмурится. 'Ты слишком мало ешь. Как ты станешь сильным?'",
    character: "Капсаицин - Попытка",
    choices: [
      { text: "Извиниться", nextScene: 71 },
      { text: "Сказать, что это нормально", nextScene: 72 }
    ]
  },
  {
    id: 60,
    text: "'Я не голоден, отец.' Ты отодвигаешь тарелку. Спайс перестаёт жевать и смотрит на тебя. 'Опять? Ты НИКОГДА не голоден!' В его голосе раздражение. 'Как ты будешь расти? Ты останешься слабым!' Он хватает кусок мяса и протягивает тебе. 'Ешь. Это приказ.'",
    character: "Капсаицин - Отказ от еды",
    choices: [
      { text: "Подчиниться", nextScene: 73 },
      { text: "Отказаться снова", nextScene: 74 }
    ]
  },
  {
    id: 67,
    text: "Ты пытаешься игнорировать царапину и продолжить. Но Спайс уже рядом. 'СТОЙ!' Он хватает твою руку, его глаза безумны от паники. 'Ты РАНЕН! Кто посмел?!' Он смотрит на деревянное оружие как на врага. 'Это... это всего лишь царапина, отец...' Но он не слушает.",
    character: "Капсаицин - Реакция на рану",
    choices: [
      { text: "Попытаться успокоить его", nextScene: 75, obsessionChange: 20 },
      { text: "Дать ему обработать рану", nextScene: 76, obsessionChange: 15, independenceChange: -10 }
    ]
  },
  {
    id: 68,
    text: "'Отец, я немного поцарапался.' Ты показываешь руку. Реакция мгновенная — Спайс хватает тебя, его лицо бледнеет. 'Кто?! Кто посмел причинить тебе боль?!' Он видит деревянное оружие и швыряет его в стену с такой силой, что оно раскалывается. 'Отец, успокойся! Это просто царапина!'",
    character: "Капсаицин - Паника отца",
    choices: [
      { text: "Смеяться над его реакцией", nextScene: 77 },
      { text: "Показать, что всё в порядке", nextScene: 78 }
    ]
  },
  {
    id: 75,
    text: "'Отец, прекрати! Это просто царапина!' Ты пытаешься вырвать руку, но его хватка железная. 'Просто царапина?! Ты ИСТЕКАЕШЬ КРОВЬЮ!' Его паника иррациональна. Он тащит тебя к лекарю, не обращая внимания на твои протесты. Вся охрана дворца поднята по тревоге из-за крошечной царапины.",
    character: "Капсаицин - Гиперопека",
    choices: [
      { text: "Сдаться и позволить лечить", nextScene: 79 },
      { text: "Плохая концовка: Запрет на всё", nextScene: 80 }
    ]
  },
  {
    id: 76,
    text: "Ты позволяешь отцу обработать рану. Он делает это с невероятной нежностью, его огромные руки дрожат. 'Больше никаких тренировок. Слишком опасно.' Его голос не терпит возражений. 'Но отец...' — 'НЕТ! Я не позволю тебе рисковать. Ты слишком драгоценен.' Он целует твою забинтованную руку.",
    character: "Капсаицин - Лечение",
    choices: [
      { text: "Попробовать переубедить", nextScene: 81 },
      { text: "Согласиться", nextScene: 82 }
    ]
  },
  {
    id: 77,
    text: "Ты не можешь сдержать смех. 'Отец, ты серьёзно? Из-за царапины?' Спайс замирает. Его лицо проходит через множество эмоций — шок, обида, гнев. 'Ты... смеёшься?' Его голос опасно тихий. 'Над моей заботой о тебе?' Он отворачивается. 'Может, мне не стоит так беспокоиться.'",
    character: "Капсаицин - Ошибка",
    choices: [
      { text: "Немедленно извиниться", nextScene: 83 },
      { text: "Объяснить, почему смеялся", nextScene: 84 }
    ]
  },
  {
    id: 78,
    text: "'Смотри, отец. Я двигаю рукой. Не болит. Всё хорошо.' Ты демонстрируешь, что рана незначительная. Спайс медленно успокаивается, но его руки всё ещё дрожат. 'Обещай мне быть осторожнее.' Его голос умоляющий. 'Я не переживу, если с тобой что-то случится.' Ты видишь настоящий страх в его глазах.",
    character: "Капсаицин - Успокоение",
    choices: [
      { text: "Обещать быть осторожным", nextScene: 85 },
      { text: "Сказать, что жизнь полна рисков", nextScene: 86 }
    ]
  },
  {
    id: 79,
    text: "Лекарь обрабатывает крошечную царапину, пока Спайс стоит над ним, проверяя каждое движение. 'Осторожнее! Не причини ему боль!' Лекарь трясётся от страха. Процедура, которая должна была занять секунды, растягивается на полчаса. Ты чувствуешь себя нелепо.",
    character: "Капсаицин - У лекаря",
    choices: [
      { text: "Продолжение истории", nextScene: 31 }
    ]
  },
  {
    id: 80,
    text: "С того дня Спайс запрещает тебе всё. Никаких тренировок, никаких прогулок, ничего, что может причинить вред. Ты живёшь в мягких подушках, окружённый стражей. Малейший синяк вызывает панику. Ты превращаешься в хрустальную куклу, заключённую в абсолютную безопасность... и абсолютную тюрьму.",
    character: "ПЛОХАЯ КОНЦОВКА - Гиперопека",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 81,
    text: "'Отец, если ты запретишь мне тренироваться, я никогда не стану сильным! Я останусь слабым навсегда!' Твои слова заставляют Спайса задуматься. Он хочет, чтобы ты был сильным... но также хочет, чтобы ты был в безопасности. Конфликт разрывает его изнутри. 'Я... подумаю об этом.'",
    character: "Капсаицин - Аргумент",
    choices: [
      { text: "Настаивать сейчас", nextScene: 87 },
      { text: "Дать ему время", nextScene: 88 }
    ]
  },
  {
    id: 82,
    text: "'Хорошо, отец. Как скажешь.' Ты сдаёшься. Спайс улыбается, довольный твоей покорностью. С этого дня твоя жизнь становится ещё более ограниченной. Но отец счастлив. Он проводит с тобой каждую минуту, оберегая от всех опасностей мира. Реальных и воображаемых.",
    character: "Капсаицин - Капитуляция",
    choices: [
      { text: "Нейтральная концовка", nextScene: 27 }
    ]
  },
  {
    id: 83,
    text: "'Прости, отец! Я не хотел обидеть!' Ты хватаешь его за руку. 'Просто... Ты так сильно переживаешь из-за мелочей.' Спайс медленно оборачивается. 'Мелочей?' Его голос дрожит. 'Твоё здоровье — это мелочь?' Ты понимаешь, что сказал неправильно. 'Нет! Я имел в виду...'",
    character: "Капсаицин - Извинение 2",
    choices: [
      { text: "Обнять его крепко", nextScene: 89 },
      { text: "Объяснить свою позицию", nextScene: 90 }
    ]
  },
  {
    id: 84,
    text: "'Я смеялся не над твоей заботой, отец. Я смеялся, потому что... ты так силён, но паникуешь из-за царапины. Это мило.' Слово 'мило' в отношении великого разрушителя звучит абсурдно. Но Спайс останавливается. 'Мило?' Он поворачивается. В его глазах удивление. 'Ты находишь меня... милым?'",
    character: "Капсаицин - Объяснение",
    choices: [
      { text: "Да, иногда ты милый", nextScene: 91 },
      { text: "Отступить назад", nextScene: 92 }
    ]
  },
  {
    id: 85,
    text: "'Обещаю, отец. Буду осторожнее.' Ты произносишь слова искренне. Спайс обнимает тебя, прижимая к своей мускулистой груди. 'Спасибо. Это всё, о чём я прошу.' Его объятие тёплое и защищающее. На мгновение ты чувствуешь себя действительно любимым. Без одержимости. Просто любимым.",
    character: "Капсаицин - Обещание осторожности",
    choices: [
      { text: "Хорошая концовка", nextScene: 31 }
    ]
  },
  {
    id: 86,
    text: "'Но отец, жизнь полна рисков. Я не могу жить в вате!' Твои слова вызывают мгновенную реакцию. Спайс хватает тебя за плечи. 'МОЖЕШЬ! Ты можешь и будешь! Я не позволю миру причинить тебе боль!' Его паника перерастает в гнев на весь мир, который может навредить тебе.",
    character: "Капсаицин - Реализм",
    choices: [
      { text: "Плохая концовка: Изоляция", nextScene: 19 }
    ]
  },
  {
    id: 87,
    text: "'Реши сейчас, отец! Я хочу тренироваться!' Твоя настойчивость раздражает Спайса. 'Не приказывай мне!' Его голос громовой. 'Я решу, когда посчитаю нужным!' Он уходит, хлопнув дверью. Ты остаёшься один, понимая, что зашёл слишком далеко.",
    character: "Капсаицин - Нетерпение",
    choices: [
      { text: "Пойти извиняться", nextScene: 93 },
      { text: "Остаться в комнате", nextScene: 16 }
    ]
  },
  {
    id: 88,
    text: "'Конечно, отец. Я подожду твоего решения.' Ты демонстрируешь зрелость. Спайс удивлён. 'Ты... действительно готов ждать?' Ты киваешь. Он обнимает тебя. 'Спасибо. Я обещаю подумать серьёзно.' В его глазах благодарность. Может, есть надежда на компромисс.",
    character: "Капсаицин - Терпение",
    choices: [
      { text: "Продолжить путь к исцелению", nextScene: 31 }
    ]
  },
  {
    id: 89,
    text: "Ты крепко обнимаешь отца, прижимаясь к его мускулистому телу. 'Я люблю тебя, отец. Твоя забота важна для меня.' Спайс замирает, затем медленно обнимает в ответ. 'Я тоже люблю тебя, сын. Слишком сильно.' Его объятие становится крепче. Почти слишком крепко. Но ты не сопротивляешься.",
    character: "Капсаицин - Примирение",
    choices: [
      { text: "Остаться в объятиях", nextScene: 94 },
      { text: "Попросить ослабить хватку", nextScene: 95 }
    ]
  },
  {
    id: 90,
    text: "'Я понимаю, что моё здоровье важно. Но небольшие риски — это часть взросления.' Ты говоришь взвешенно. Спайс слушает. Действительно слушает. 'Взросления...' Он повторяет слово, как будто пробует его на вкус. 'Ты прав. Я... забочусь слишком сильно.' Это первый раз, когда он признаёт проблему.",
    character: "Капсаицин - Зрелость",
    choices: [
      { text: "Путь к исцелению", nextScene: 31 }
    ]
  },
  {
    id: 91,
    text: "'Да, отец. Иногда ты милый.' Ты улыбаешься искренне. Спайс смотрит на тебя, его суровое лицо смягчается. 'Милый...' Он качает головой, но улыбается. 'Великий разрушитель... милый.' Он рассмеивается — редкий, настоящий смех. 'Только ты можешь говорить мне такое и остаться в живых.'",
    character: "Капсаицин - Тёплый момент",
    choices: [
      { text: "Смеяться вместе с ним", nextScene: 96 },
      { text: "Поцеловать его в щёку", nextScene: 97 }
    ]
  },
  {
    id: 92,
    text: "'Я... наверное, неправильно выразился.' Ты отступаешь. Спайс делает шаг вперёд. 'Нет. Ты сказал, что я милый.' Его взгляд странный, интенсивный. 'Я хочу быть милым для тебя. Я хочу быть всем для тебя.' Он приближается. 'Ты понимаешь?'",
    character: "Капсаицин - Напряжение",
    choices: [
      { text: "Я не понимаю", nextScene: 98 },
      { text: "Отступить к двери", nextScene: 99 }
    ]
  },
  {
    id: 93,
    text: "Ты находишь отца в его покоях. Он сидит у окна, его длинные волосы рассыпаны вокруг. 'Отец... Прости. Я не должен был настаивать.' Спайс не оборачивается. 'Ты растёшь. Скоро ты больше не будешь нуждаться во мне.' В его голосе боль. 'Это не так! Я всегда буду нуждаться в тебе!'",
    character: "Капсаицин - Примирение 2",
    choices: [
      { text: "Обнять его сзади", nextScene: 100 },
      { text: "Сесть рядом", nextScene: 101 }
    ]
  },
  {
    id: 94,
    text: "Ты остаёшься в его объятиях долго. Очень долго. Его дыхание у твоего уха, его руки обхватывают тебя полностью. 'Хочу остановить время,' — шепчет он. 'Чтобы ты навсегда остался таким. Моим маленьким мальчиком.' Ты чувствуешь, что это одновременно и красиво, и тревожно.",
    character: "Капсаицин - Близость",
    choices: [
      { text: "Я всегда буду твоим сыном", nextScene: 27 },
      { text: "Но я должен взрослеть", nextScene: 102 }
    ]
  },
  {
    id: 95,
    text: "'Отец... Ты держишь слишком крепко.' Твой голос приглушён его грудью. Спайс немедленно отпускает, словно обжёгшись. 'Прости! Я не хотел... Я забываю о своей силе.' Он смотрит на свои огромные руки виновато. 'Иногда боюсь, что случайно причиню тебе боль.'",
    character: "Капсаицин - Осторожность",
    choices: [
      { text: "Ты никогда не причинишь мне боль", nextScene: 103 },
      { text: "Нужно быть осторожнее", nextScene: 104 }
    ]
  },
  {
    id: 96,
    text: "Вы смеётесь вместе. Это редкий момент настоящего счастья. Без напряжения, без одержимости. Просто отец и сын, смеющиеся вместе. 'Я так редко смеюсь,' — говорит Спайс, вытирая слезу. 'Только с тобой.' Он тянет тебя в объятия. 'Спасибо, что напоминаешь мне, как это — быть счастливым.'",
    character: "Капсаицин - Счастье",
    choices: [
      { text: "Лучшая концовка", nextScene: 37 }
    ]
  },
  {
    id: 97,
    text: "Ты встаёшь на цыпочки и целуешь отца в щёку. Невинный, детский жест. Но Спайс замирает полностью. Его глаза расширяются, дыхание учащается. 'Капсаицин...' Его голос хриплый. Он касается места поцелуя, как будто не верит. 'Ты... поцеловал меня.' Его реакция странно интенсивна для простого поцелуя в щёку.",
    character: "Капсаицин - Невинный жест",
    choices: [
      { text: "Это просто поцелуй, отец", nextScene: 105, obsessionChange: 10 },
      { text: "Смутиться от его реакции", nextScene: 106, obsessionChange: 20 }
    ]
  },
  {
    id: 98,
    text: "'Я не понимаю, отец.' Твоя невинность очевидна. Спайс останавливается, борясь с собой. 'Хорошо. Лучше, чтобы ты не понимал. Пока.' Он отступает. 'Иди. Отдыхай.' Он отворачивается, его кулаки сжаты. Ты уходишь, чувствуя странное напряжение в воздухе.",
    character: "Капсаицин - Невежество",
    choices: [
      { text: "Уйти в покои", nextScene: 16 }
    ]
  },
  {
    id: 99,
    text: "Ты медленно отступаешь к двери. Спайс следует за тобой, шаг за шагом. 'Ты боишься меня?' В его голосе боль. 'Я пугаю тебя, сын мой?' Его лицо искажается страданием. 'Я только хочу... любить тебя. Правильно ли это или нет.' Он останавливается. 'Иди. Уходи, пока я позволяю.'",
    character: "Капсаицин - Страх",
    choices: [
      { text: "Убежать", nextScene: 38, independenceChange: 30 },
      { text: "Остаться и обнять его", nextScene: 107, obsessionChange: -20, trustChange: 25 }
    ]
  },
  {
    id: 100,
    text: "Ты обнимаешь отца сзади, твои маленькие руки едва обхватывают его широкую спину. 'Я всегда буду нуждаться в тебе, отец.' Спайс замирает, затем накрывает твои руки своими. 'Обещай.' — 'Обещаю.' Вы сидите так долго, наблюдая закат над пустыней.",
    character: "Капсаицин - Нежность",
    choices: [
      { text: "Хорошая концовка", nextScene: 31 }
    ]
  },
  {
    id: 101,
    text: "Ты садишься рядом с отцом молча. Иногда слова не нужны. Вы смотрите на пустыню вместе. 'Знаешь,' — говорит Спайс тихо, — 'иногда мне кажется, что я сойду с ума от страха потерять тебя.' Ты берёшь его огромную руку в свою маленькую. 'Я здесь, отец. Я здесь.'",
    character: "Капсаицин - Тишина вдвоём",
    choices: [
      { text: "Продолжить сидеть молча", nextScene: 31 }
    ]
  },
  {
    id: 102,
    text: "'Но я должен взрослеть, отец. Это естественно.' Твои слова разумны. Спайс знает это. Но это не делает их менее болезненными. 'Я знаю,' — говорит он тихо. 'Но знание не облегчает боль.' Он отпускает тебя. 'Хорошо. Взрослей. Но обещай... никогда не уходить далеко.'",
    character: "Капсаицин - Компромисс о взрослении",
    choices: [
      { text: "Обещать", nextScene: 31 }
    ]
  },
  {
    id: 103,
    text: "'Ты никогда не причинишь мне боль намеренно, отец. Я знаю.' Твоё доверие трогает Спайса до глубины души. 'Как ты можешь быть так уверен?' — 'Потому что ты любишь меня.' Простой ответ. Но для Спайса — откровение. Впервые за тысячи лет кто-то верит в него безоговорочно.",
    character: "Капсаицин - Доверие",
    choices: [
      { text: "Лучшая концовка", nextScene: 37 }
    ]
  },
  {
    id: 104,
    text: "'Ты должен быть осторожнее, отец. Ты очень сильный.' Твои слова — мягкое напоминание. Спайс кивает серьёзно. 'Ты прав. Я буду... Я постараюсь контролировать себя лучше.' Это маленький шаг. Но это шаг к здоровым отношениям.",
    character: "Капсаицин - Границы",
    choices: [
      { text: "Хорошая концовка", nextScene: 31 }
    ]
  },
  {
    id: 105,
    text: "'Это просто поцелуй, отец. Знак любви.' Ты говоришь это невинно. Спайс закрывает глаза, глубоко дыша. 'Да. Конечно. Знак любви.' Он повторяет, как мантру. 'Просто... будь осторожен с такими жестами. Не все воспримут их так невинно, как ты намерен.' Предупреждение в его голосе.",
    character: "Капсаицин - Невинное объяснение",
    choices: [
      { text: "Я понял", nextScene: 31 }
    ]
  },
  {
    id: 106,
    text: "Ты краснеешь от интенсивности его реакции. 'Прости... Я не хотел...' — 'Нет!' Спайс хватает тебя за плечи. 'Не извиняйся! Никогда не извиняйся за проявление любви!' Его глаза горят. 'Просто... просто предупреди меня в следующий раз.' Он улыбается странно. 'Моё сердце может не выдержать.'",
    character: "Капсаицин - Смущение от реакции",
    choices: [
      { text: "Улыбнуться в ответ", nextScene: 96 }
    ]
  },
  {
    id: 107,
    text: "Вместо того чтобы убежать, ты бросаешься к отцу и обнимаешь его крепко. 'Я не боюсь тебя! Я люблю тебя!' Спайс падает на колени, обхватывая тебя. Он рыдает — впервые за столетия. 'Прости... Прости меня...' Вы плачете вместе. Это начало долгого пути исцеления.",
    character: "Капсаицин - Мужество любви",
    choices: [
      { text: "Лучшая концовка", nextScene: 37 }
    ]
  },
  {
    id: 71,
    text: "'Прости, отец. Я постараюсь есть больше.' Ты чувствуешь вину. Спайс вздыхает. 'Не извиняйся. Просто... попробуй.' Он кладёт маленький кусок мяса на твою тарелку. 'Хоть немного. Ради меня.' Ты киваешь, хотя желудок уже протестует.",
    character: "Капсаицин - Вина",
    choices: [
      { text: "Попытаться съесть", nextScene: 108 }
    ]
  },
  {
    id: 72,
    text: "'Отец, для меня это нормально. Я просто... ем мало. Всегда ел.' Ты пытаешься объяснить. Спайс хмурится, но не настаивает дальше. 'Хорошо. Но если ты заболеешь из-за недостатка питания...' Угроза повисает в воздухе. Ты не уверен, кому он угрожает — тебе или миру.",
    character: "Капсаицин - Отстаивание",
    choices: [
      { text: "Продолжить ужин молча", nextScene: 109 }
    ]
  },
  {
    id: 73,
    text: "Ты послушно берёшь мясо и начинаешь жевать. Оно безвкусно. Тошнота подкатывает, но ты продолжаешь, глядя на довольное лицо отца. 'Вот и хорошо! Видишь, ты можешь!' Он улыбается. Ты улыбаешься в ответ, хотя внутри всё сжимается.",
    character: "Капсаицин - Подчинение еде",
    choices: [
      { text: "Доесть всё", nextScene: 110 },
      { text: "Попросить отлучиться", nextScene: 111 }
    ]
  },
  {
    id: 74,
    text: "'Нет, отец. Я не буду.' Твоё упрямство удивляет обоих. Лицо Спайса темнеет. 'Что ты сказал?' Его голос опасно тихий. 'Я сказал нет.' Ты держишься. Напряжение в зале можно резать ножом. Спайс медленно встаёт...",
    character: "Капсаицин - Бунт",
    choices: [
      { text: "Сбежать из зала", nextScene: 16 },
      { text: "Держать позицию", nextScene: 112 }
    ]
  },
  {
    id: 108,
    text: "Ты съедаешь кусок за куском, заставляя себя. Спайс наблюдает с одобрением. Когда ты наконец заканчиваешь, он гладит тебя по голове. 'Молодец, сын. Так намного лучше.' Ты чувствуешь себя переполненным и больным, но его похвала частично компенсирует дискомфорт.",
    character: "Капсаицин - Жертва",
    choices: [
      { text: "Попросить отдохнуть", nextScene: 16 }
    ]
  },
  {
    id: 109,
    text: "Ужин проходит в напряжённом молчании. Спайс пожирает огромные количества мяса, ты ковыряешься в своей тарелке. Иногда он бросает на тебя обеспокоенные взгляды, но не комментирует. Молчание говорит больше, чем слова.",
    character: "Капсаицин - Тихий ужин",
    choices: [
      { text: "Закончить ужин", nextScene: 31 }
    ]
  },
  {
    id: 110,
    text: "Ты доедаешь всё до последней крошки. Спайс сияет от гордости. Но как только он отворачивается, тебя начинает тошнить. Ты пытаешься сдержаться, но... слишком поздно. Спайс в панике: 'Что случилось?! Еда была отравлена?!' Он кричит на слуг. Это катастрофа.",
    character: "Капсаицин - Переедание",
    choices: [
      { text: "Объяснить, что просто переел", nextScene: 113 },
      { text: "Промолчать", nextScene: 114 }
    ]
  },
  {
    id: 111,
    text: "'Отец, можно мне отлучиться?' Ты чувствуешь, как желудок протестует. Спайс кивает. 'Конечно. Ты хорошо поел.' Ты спешишь в уборную. После этого ты чувствуешь себя лучше физически, но хуже эмоционально. Почему не можешь просто быть нормальным?",
    character: "Капсаицин - Облегчение",
    choices: [
      { text: "Вернуться к отцу", nextScene: 31 }
    ]
  },
  {
    id: 112,
    text: "Ты остаёшься на месте, смотришь отцу в глаза. 'Я. Не. Буду.' Каждое слово — вызов. Спайс подходит, нависает над тобой. Его огромная фигура отбрасывает тень. 'Ты бросаешь мне вызов?' Тишина. Затем, неожиданно, он смеётся. 'У тебя есть позвоночник. Хорошо. Не ешь. Но не жалуйся на слабость.'",
    character: "Капсаицин - Уважение через конфронтацию",
    choices: [
      { text: "Закончить ужин", nextScene: 115 }
    ]
  },
  {
    id: 113,
    text: "'Отец, успокойся! Я просто переел. Слишком много для меня.' Ты пытаешься остановить панику. Спайс замирает. 'Переел?' Реализация приходит медленно. 'Я... заставил тебя переесть.' Вина на его лице. 'Прости. Я не хотел...' Он нежно уносит тебя в покои.",
    character: "Капсаицин - Последствия",
    choices: [
      { text: "Принять его заботу", nextScene: 31 }
    ]
  },
  {
    id: 114,
    text: "Ты не говоришь, что переел. Спайс приказывает казнить повара, который готовил ужин. Ты слышишь крики. Всё из-за того, что ты не смог сказать правду. Вина будет преследовать тебя долго. Очень долго.",
    character: "Капсаицин - Молчание с последствиями",
    choices: [
      { text: "Плохая концовка: Вина", nextScene: 116 }
    ]
  },
  {
    id: 115,
    text: "Ужин заканчивается на удивление мирно. Спайс ест своё, ты ешь своё минимальное количество. Он не комментирует. Это маленькая победа независимости. Может, не всё потеряно.",
    character: "Капсаицин - Маленькая победа независимости",
    choices: [
      { text: "Хорошая концовка", nextScene: 31 }
    ]
  },
  {
    id: 116,
    text: "С того дня ты ешь всё, что отец кладёт на твою тарелку. Не потому, что голоден. А потому, что не можешь жить с виной ещё одной смерти. Ты толстеешь, становишься больным, но продолжаешь есть. Спайс доволен, не замечая, что медленно убивает тебя своей 'заботой'.",
    character: "ПЛОХАЯ КОНЦОВКА - Вина и саморазрушение",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  }
];

export default function Index() {
  const [currentScene, setCurrentScene] = useState(0);
  const [visitedScenes, setVisitedScenes] = useState<number[]>([0]);
  const [stats, setStats] = useState<Stats>({
    obsession: 50,
    trust: 50,
    independence: 30
  });

  const scene = storyData[currentScene];

  const handleChoice = (nextScene: number, choice: Choice) => {
    if (nextScene === 0 && currentScene !== 0) {
      setStats({
        obsession: 50,
        trust: 50,
        independence: 30
      });
      setVisitedScenes([0]);
    } else {
      if (!visitedScenes.includes(nextScene)) {
        setVisitedScenes([...visitedScenes, nextScene]);
      }
      
      setStats(prev => ({
        obsession: Math.max(0, Math.min(100, prev.obsession + (choice.obsessionChange || 0))),
        trust: Math.max(0, Math.min(100, prev.trust + (choice.trustChange || 0))),
        independence: Math.max(0, Math.min(100, prev.independence + (choice.independenceChange || 0)))
      }));
    }
    
    setCurrentScene(nextScene);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  const getObsessionLevel = () => {
    if (stats.obsession >= 80) return { text: "КРИТИЧЕСКАЯ", color: "text-red-600", bg: "bg-red-500" };
    if (stats.obsession >= 60) return { text: "Высокая", color: "text-orange-600", bg: "bg-orange-500" };
    if (stats.obsession >= 40) return { text: "Умеренная", color: "text-yellow-600", bg: "bg-yellow-500" };
    return { text: "Низкая", color: "text-green-600", bg: "bg-green-500" };
  };

  const obsessionLevel = getObsessionLevel();

  return (
    <div className="min-h-screen bg-gradient-to-br from-[#2D1B3D] via-[#3d2647] to-[#8B47B7] flex items-center justify-center p-4 font-sans">
      <div className="max-w-4xl w-full">
        <div className="text-center mb-8 animate-fade-in">
          <h1 className="text-5xl md:text-6xl font-serif text-white mb-2 text-shadow">
            Королевство в Пустыне
          </h1>
          <p className="text-[#8B4789] text-lg">
            Глава {visitedScenes.length} из {storyData.length}
          </p>
        </div>

        <Card className="bg-white/95 backdrop-blur p-8 md:p-12 rounded-2xl shadow-2xl animate-fade-in">
          <div className="mb-6 space-y-4">
            {scene.character && (
              <div className="flex items-center gap-2 text-primary/70">
                <Icon name="User" size={20} />
                <span className="font-semibold text-sm uppercase tracking-wider">
                  {scene.character}
                </span>
              </div>
            )}
            
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-muted/30 rounded-xl">
              <div className="space-y-2">
                <div className="flex items-center justify-between text-sm">
                  <div className="flex items-center gap-2">
                    <Icon name="Heart" size={16} className={obsessionLevel.color} />
                    <span className="font-medium">Одержимость</span>
                  </div>
                  <span className={`font-bold ${obsessionLevel.color}`}>{obsessionLevel.text}</span>
                </div>
                <div className="h-2 bg-gray-200 rounded-full overflow-hidden">
                  <div 
                    className={`h-full ${obsessionLevel.bg} transition-all duration-500`}
                    style={{ width: `${stats.obsession}%` }}
                  />
                </div>
                <p className="text-xs text-muted-foreground">{stats.obsession}%</p>
              </div>

              <div className="space-y-2">
                <div className="flex items-center justify-between text-sm">
                  <div className="flex items-center gap-2">
                    <Icon name="Shield" size={16} className="text-blue-600" />
                    <span className="font-medium">Доверие</span>
                  </div>
                  <span className="font-bold text-blue-600">{stats.trust}%</span>
                </div>
                <div className="h-2 bg-gray-200 rounded-full overflow-hidden">
                  <div 
                    className="h-full bg-blue-500 transition-all duration-500"
                    style={{ width: `${stats.trust}%` }}
                  />
                </div>
                <p className="text-xs text-muted-foreground">Доверие Спайса к тебе</p>
              </div>

              <div className="space-y-2">
                <div className="flex items-center justify-between text-sm">
                  <div className="flex items-center gap-2">
                    <Icon name="Sparkles" size={16} className="text-purple-600" />
                    <span className="font-medium">Независимость</span>
                  </div>
                  <span className="font-bold text-purple-600">{stats.independence}%</span>
                </div>
                <div className="h-2 bg-gray-200 rounded-full overflow-hidden">
                  <div 
                    className="h-full bg-purple-500 transition-all duration-500"
                    style={{ width: `${stats.independence}%` }}
                  />
                </div>
                <p className="text-xs text-muted-foreground">Твоя свобода</p>
              </div>
            </div>
          </div>

          {stats.obsession >= 80 && !scene.isEnding && (
            <div className="mb-6 p-4 bg-red-50 border-l-4 border-red-500 rounded">
              <div className="flex items-center gap-2 text-red-800">
                <Icon name="AlertTriangle" size={20} />
                <span className="font-bold text-sm">ПРЕДУПРЕЖДЕНИЕ: Одержимость Спайса достигла критического уровня!</span>
              </div>
              <p className="text-red-700 text-sm mt-1">Твои выборы определят судьбу ваших отношений...</p>
            </div>
          )}

          {stats.independence <= 10 && !scene.isEnding && (
            <div className="mb-6 p-4 bg-orange-50 border-l-4 border-orange-500 rounded">
              <div className="flex items-center gap-2 text-orange-800">
                <Icon name="AlertCircle" size={20} />
                <span className="font-bold text-sm">Твоя независимость на грани исчезновения...</span>
              </div>
            </div>
          )}

          <div className="prose prose-lg max-w-none mb-8">
            <p className="text-foreground leading-relaxed font-serif text-lg md:text-xl">
              {scene.text}
            </p>
          </div>

          <div className="space-y-3">
            {scene.choices.map((choice, index) => (
              <div key={index} className="relative group">
                <Button
                  onClick={() => handleChoice(choice.nextScene, choice)}
                  className="w-full text-left justify-start h-auto py-4 px-6 bg-primary hover:bg-primary/90 text-primary-foreground rounded-xl text-base md:text-lg font-medium transition-all duration-200 hover:scale-[1.02] shadow-md"
                >
                  <Icon name="ChevronRight" size={20} className="mr-2 flex-shrink-0" />
                  <span className="flex-1">{choice.text}</span>
                  {(choice.obsessionChange || choice.trustChange || choice.independenceChange) && (
                    <div className="ml-3 flex gap-1 flex-shrink-0">
                      {choice.obsessionChange && (
                        <span className={`text-xs px-2 py-1 rounded ${choice.obsessionChange > 0 ? 'bg-red-500/20 text-red-200' : 'bg-green-500/20 text-green-200'}`}>
                          {choice.obsessionChange > 0 ? '↑' : '↓'} Одержимость
                        </span>
                      )}
                      {choice.trustChange && (
                        <span className={`text-xs px-2 py-1 rounded ${choice.trustChange > 0 ? 'bg-blue-500/20 text-blue-200' : 'bg-gray-500/20 text-gray-200'}`}>
                          {choice.trustChange > 0 ? '↑' : '↓'} Доверие
                        </span>
                      )}
                      {choice.independenceChange && (
                        <span className={`text-xs px-2 py-1 rounded ${choice.independenceChange > 0 ? 'bg-purple-500/20 text-purple-200' : 'bg-gray-500/20 text-gray-200'}`}>
                          {choice.independenceChange > 0 ? '↑' : '↓'} Независимость
                        </span>
                      )}
                    </div>
                  )}
                </Button>
              </div>
            ))}
          </div>

          {scene.isEnding && (
            <div className="mt-8 pt-8 border-t border-muted-foreground/20 space-y-4">
              <p className="text-muted-foreground italic text-center">
                Продолжение следует...
              </p>
              <div className="grid grid-cols-3 gap-4 text-center text-sm">
                <div>
                  <p className="font-bold text-foreground">Итоговая одержимость</p>
                  <p className={`text-2xl font-bold ${obsessionLevel.color}`}>{stats.obsession}%</p>
                  <p className="text-muted-foreground">{obsessionLevel.text}</p>
                </div>
                <div>
                  <p className="font-bold text-foreground">Итоговое доверие</p>
                  <p className="text-2xl font-bold text-blue-600">{stats.trust}%</p>
                </div>
                <div>
                  <p className="font-bold text-foreground">Итоговая независимость</p>
                  <p className="text-2xl font-bold text-purple-600">{stats.independence}%</p>
                </div>
              </div>
            </div>
          )}
        </Card>

        <div className="mt-6 flex justify-center gap-6 text-white/60 text-sm">
          <div className="flex items-center gap-2">
            <Icon name="BookOpen" size={16} />
            <span>Визуальная новелла</span>
          </div>
          <div className="flex items-center gap-2">
            <Icon name="Bookmark" size={16} />
            <span>{visitedScenes.length} посещено</span>
          </div>
        </div>
      </div>
    </div>
  );
}