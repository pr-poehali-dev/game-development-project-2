import { useState } from 'react';
import { Card } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import Icon from '@/components/ui/icon';

interface Choice {
  text: string;
  nextScene: number;
}

interface Scene {
  id: number;
  text: string;
  choices: Choice[];
  character?: string;
  isEnding?: boolean;
}

const storyData: Scene[] = [
  {
    id: 0,
    text: "Среди бескрайних песков раскалённой пустыни возвышается величественный дворец из песчаника. Здесь правит Бурнинг Спайс — великий разрушитель, чье имя внушает страх всем королевствам. Его чёрные волосы до самого пола развеваются на жарком ветру, жёлтые дорогие одежды с красным поясом подчёркивают мускулистую фигуру. Верх его тела открыт — доспехи для слабаков, как он сам говорит...",
    choices: [
      { text: "Войти во дворец", nextScene: 1 }
    ]
  },
  {
    id: 1,
    text: "В тронном зале, где жара пустыни смягчается лишь толстыми стенами, восседает Бурнинг Спайс. Его растрёпанные чёрные волосы касаются пола, а мускулистое тело напряжено. Рядом с ним стоит Капсаицин — единственный луч света в жестокой жизни правителя. Мальчику всего 13 лет, но он видит в отце не тирана, а того, кто нуждается в понимании.",
    character: "Бурнинг Спайс и Капсаицин",
    choices: [
      { text: "Наблюдать за Спайсом", nextScene: 2 },
      { text: "Обратить внимание на Капсаицина", nextScene: 3 }
    ]
  },
  {
    id: 2,
    text: "Бурнинг Спайс смотрит в окно на пустыню. Его длинные волосы — символ силы — развеваются от сквозняка. Тысячи лет одиночества оставили свой след. После появления Капсаицина что-то изменилось... Чувства, которые он испытывает к сыну, становятся всё более неоднозначными и собственническими. Это пугает даже его самого.",
    character: "Бурнинг Спайс",
    choices: [
      { text: "Продолжить историю", nextScene: 4 }
    ]
  },
  {
    id: 3,
    text: "Капсаицин смотрит на отца с любовью и пониманием. Он восхищается силой отца, его длинными волосами и мощью. Мальчик видит вспышки гнева, разрушительную силу, но для него Спайс остается защитником. Он не понимает, почему отец так строго контролирует каждый его шаг, не позволяя принимать даже малейшие решения самому...",
    character: "Капсаицин",
    choices: [
      { text: "Продолжить историю", nextScene: 4 }
    ]
  },
  {
    id: 4,
    text: "За окнами дворца простирается королевство, где каждый житель живет в страхе и жаре пустыни. Они носят лёгкие одежды, приспособленные к климату. Спайс может разрушить чей-то дом ради забавы, когда ему скучно. Он восхваляет себя как бога для простолюдинов. Но внутри дворца, рядом с Капсаицином, он чувствует себя... одержимым собственником.",
    choices: [
      { text: "День с репетитором", nextScene: 5 },
      { text: "Прогулка во дворце", nextScene: 6 }
    ]
  },
  {
    id: 5,
    text: "К Капсаицину приходит новый репетитор — пожилой учёный из соседнего королевства. Он учит мальчика истории и философии. Капсаицин увлечён, задаёт вопросы, смеётся над шутками учителя. Внезапно дверь распахивается — входит Спайс. Его взгляд холоден как лёд, несмотря на жар пустыни за окном. Волосы развеваются от ярости.",
    character: "Спайс и репетитор",
    choices: [
      { text: "Спайс изгоняет репетитора", nextScene: 8 },
      { text: "Капсаицин заступается за учителя", nextScene: 9 }
    ]
  },
  {
    id: 6,
    text: "Капсаицин гуляет по коридорам дворца. Один из молодых слуг приветливо улыбается мальчику и предлагает показать ему тайный сад во внутреннем дворе — оазис прохлады среди жары. Капсаицин радостно соглашается. Но за колонной стоит Спайс, его мускулы напряжены, кулаки сжаты...",
    character: "Капсаицин и слуга",
    choices: [
      { text: "Спайс вмешивается немедленно", nextScene: 10 },
      { text: "Спайс следит издалека", nextScene: 11 }
    ]
  },
  {
    id: 8,
    text: "'УЙДИ!' — рычит Спайс, его голос заставляет дрожать стены. Репетитор в ужасе убегает. Спайс подходит к Капсаицину, его взгляд безумен: 'Никто не смеет смешить тебя, кроме меня! Никто не смеет учить тебя, кроме меня! Ты МОЙ сын!' Капсаицин в шоке от такой вспышки ревности...",
    character: "Бурнинг Спайс",
    choices: [
      { text: "Капсаицин молчит от страха", nextScene: 13 },
      { text: "Капсаицин пытается успокоить отца", nextScene: 14 }
    ]
  },
  {
    id: 9,
    text: "'Отец, пожалуйста! Он просто учит меня!' — умоляет Капсаицин. Спайс смотрит на сына, его ревность борется с нежностью. 'Ты не понимаешь... Все хотят украсть тебя у меня. Все хотят забрать единственное, что у меня есть.' Его голос дрожит от боли тысячелетий предательства.",
    character: "Конфликт",
    choices: [
      { text: "Репетитор остаётся, но под надзором", nextScene: 15 },
      { text: "Спайс всё равно изгоняет его", nextScene: 8 }
    ]
  },
  {
    id: 10,
    text: "Спайс появляется из ниоткуда, его длинные волосы развеваются от ярости. Одним движением он отшвыривает слугу к стене. 'Не смей ПРИКАСАТЬСЯ к моему сыну!' Слуга падает без сознания. Капсаицин в ужасе смотрит на отца. 'Отец... Он просто хотел...' — 'МОЛЧАТЬ! Никто не имеет права быть рядом с тобой!'",
    character: "Вспышка ярости",
    choices: [
      { text: "Капсаицин убегает в свои покои", nextScene: 16 },
      { text: "Капсаицин остаётся с отцом", nextScene: 17 }
    ]
  },
  {
    id: 11,
    text: "Спайс следит за ними из тени. Каждый раз, когда слуга улыбается Капсаицину, правитель сжимает кулаки до крови. Каждый смех мальчика — как нож в сердце. 'Почему он смеётся с НИМ, а не со мной?' — думает Спайс. Ревность пожирает его изнутри сильнее, чем жар пустыни...",
    character: "Внутренний монолог Спайса",
    choices: [
      { text: "Спайс прерывает их", nextScene: 10 },
      { text: "Спайс сдерживается, но страдает", nextScene: 18 }
    ]
  },
  {
    id: 13,
    text: "Капсаицин замолкает, его глаза наполняются слезами. Спайс видит страх в глазах сына — и это разбивает его сердце. Он опускается на колени, его длинные волосы рассыпаются по полу: 'Прости... Я просто... Я не могу тебя потерять. Ты всё, что у меня есть.' Его голос ломается.",
    character: "Момент слабости",
    choices: [
      { text: "Плохая концовка: Изоляция", nextScene: 19 },
      { text: "Капсаицин обнимает отца", nextScene: 20 }
    ]
  },
  {
    id: 14,
    text: "Капсаицин осторожно подходит к отцу и обнимает его. 'Отец... Я никогда не уйду от тебя. Но мне нужны друзья, учителя... Я не могу жить только с тобой.' Спайс обнимает сына так крепко, что мальчику больно. 'Нет... Нет, ты не понимаешь... Они все предатели...'",
    character: "Попытка диалога",
    choices: [
      { text: "Настаивать на своей независимости", nextScene: 21 },
      { text: "Подчиниться воле отца", nextScene: 22 }
    ]
  },
  {
    id: 15,
    text: "Репетитор остаётся, но теперь Спайс всегда присутствует на занятиях. Он сидит в углу, его взгляд не отрывается от учителя. Каждое слово, каждый жест анализируется. Репетитор нервничает, Капсаицин чувствует себя неловко. Атмосфера давит...",
    character: "Напряжённые уроки",
    choices: [
      { text: "Продолжать так жить", nextScene: 23 },
      { text: "Попросить отца уйти", nextScene: 24 }
    ]
  },
  {
    id: 16,
    text: "Капсаицин убегает в свои покои и запирается. Он плачет от страха и непонимания. За дверью слышны шаги — Спайс ходит туда-сюда всю ночь. Иногда он тихо говорит: 'Прости... Прости, сын мой...' Но утром ревность вернётся снова. Это замкнутый круг.",
    character: "Одиночество",
    choices: [
      { text: "Плохая концовка: Золотая клетка", nextScene: 25 },
      { text: "Попытаться поговорить утром", nextScene: 26 }
    ]
  },
  {
    id: 17,
    text: "Капсаицин не убегает. Он остаётся рядом с отцом, видя его боль. 'Отец... Я здесь. Я с тобой.' Спайс обнимает сына, его огромные мускулистые руки дрожат. 'Обещай мне... Обещай, что никогда не покинешь меня.' В его голосе — тысячелетия одиночества и страха.",
    character: "Близость",
    choices: [
      { text: "Обещать остаться навсегда", nextScene: 27 },
      { text: "Сказать правду о своих чувствах", nextScene: 28 }
    ]
  },
  {
    id: 18,
    text: "Спайс сдерживается. Он не вмешивается, но каждая секунда — пытка. Он видит, как Капсаицин счастлив с кем-то другим. Возвращается в свои покои и разрушает половину мебели в ярости. Его длинные волосы в беспорядке, мускулы напряжены до предела. Он не может так больше...",
    character: "Внутренняя борьба",
    choices: [
      { text: "Плохая концовка: Взрыв ярости", nextScene: 29 },
      { text: "Попытаться измениться", nextScene: 30 }
    ]
  },
  {
    id: 19,
    text: "С того дня Капсаицин больше не видит никого, кроме отца. Все слуги, учителя, даже стражи изгнаны или казнены. Дворец становится тюрьмой для двоих. Спайс счастлив — сын принадлежит только ему. Но в глазах Капсаицина гаснет свет. Он превращается в тень, живущую в золотой клетке...",
    character: "ПЛОХАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 20,
    text: "Капсаицин обнимает отца. Оба плачут. Это момент истины — Спайс понимает, что его ревность разрушает единственного, кого он любит. 'Я постараюсь... Я постараюсь быть лучше,' — шепчет он. Путь будет долгим, но появилась надежда...",
    character: "Момент надежды",
    choices: [
      { text: "Хорошая концовка: Путь к исцелению", nextScene: 31 }
    ]
  },
  {
    id: 21,
    text: "'Отец, я люблю тебя, но так жить нельзя!' — кричит Капсаицин. Спайс отступает, его глаза расширяются от боли. 'Значит... Ты тоже хочешь меня покинуть...' Он медленно встаёт. Его лицо становится каменным. Ревность превращается в гнев. В ярость. В разрушение...",
    character: "Точка невозврата",
    choices: [
      { text: "Плохая концовка: Разрушение", nextScene: 32 }
    ]
  },
  {
    id: 22,
    text: "Капсаицин опускает голову. 'Хорошо, отец... Как скажешь.' Спайс улыбается — триумф ревности. С этого дня Капсаицин живёт под полным контролем. Каждый шаг, каждое слово под надзором. Любовь превращается в собственничество. Сын становится прекрасной игрушкой в руках одержимого правителя...",
    character: "ПЛОХАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 23,
    text: "Месяцы проходят в такой атмосфере. Репетитор в конце концов не выдерживает напряжения и сбегает. Капсаицин снова остаётся один на один с отцом. Спайс доволен. 'Видишь? Все уходят. Остаюсь только я. Только я люблю тебя по-настоящему.' Капсаицин начинает верить в эти слова...",
    character: "Медленное разрушение",
    choices: [
      { text: "Плохая концовка: Промывка мозгов", nextScene: 33 }
    ]
  },
  {
    id: 24,
    text: "'Отец, пожалуйста, уйди. Мне нужно учиться в нормальной обстановке.' Спайс замирает. Его просят уйти. ЕГО. Великого разрушителя. Его собственный сын просит уйти. Ревность взрывается ядерным грибом. 'Значит, он тебе важнее, чем я?!' — рычит он, хватая Капсаицина за плечи...",
    character: "Вспышка ревности",
    choices: [
      { text: "Плохая концовка: Насилие", nextScene: 34 },
      { text: "Спайс останавливает себя в последний момент", nextScene: 35 }
    ]
  },
  {
    id: 25,
    text: "Годы проходят. Капсаицин больше не пытается сопротивляться. Он живёт в роскошных покоях, но это золотая клетка. Спайс проводит с ним каждую минуту. Ревность стала нормой. Любовь превратилась в одержимость. Капсаицин больше не улыбается. Он просто существует...",
    character: "ПЛОХАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 26,
    text: "Утром Капсаицин открывает дверь. Спайс сидит прямо на полу у входа, его длинные волосы рассыпаны вокруг. Он не спал всю ночь. 'Отец...' — 'Прости меня,' — шепчет Спайс. 'Я чудовище. Но я не знаю, как иначе...' В его глазах — настоящая боль.",
    character: "Утреннее раскаяние",
    choices: [
      { text: "Предложить вместе найти решение", nextScene: 36 },
      { text: "Продолжать как прежде", nextScene: 22 }
    ]
  },
  {
    id: 27,
    text: "'Я обещаю, отец. Я останусь с тобой навсегда.' Спайс прижимает сына к себе. Это обещание становится цепью. Годы проходят, Капсаицин взрослеет, но никогда не покидает дворец. Он отказывается от своей жизни ради отца. Это любовь? Или жертва? Граница размыта...",
    character: "НЕЙТРАЛЬНАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 28,
    text: "'Отец, я люблю тебя. Но любовь не означает владение. Я твой сын, но я также отдельный человек. Мне нужно пространство, чтобы расти.' Спайс слушает. Каждое слово — как удар мечом. Но он СЛУШАЕТ. Впервые за тысячи лет он действительно слышит кого-то...",
    character: "Момент истины",
    choices: [
      { text: "Хорошая концовка: Принятие", nextScene: 37 }
    ]
  },
  {
    id: 29,
    text: "Ночью Спайс врывается в покои слуги. То, что происходит дальше, не стоит описывать. На следующее утро все во дворце знают — никто не смеет приближаться к Капсаицину. Мальчик становится неприкасаемым. Изолированным. Одиноким. Спайс уничтожил всё вокруг своего сына во имя 'любви'...",
    character: "ПЛОХАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 30,
    text: "Спайс смотрит на себя в зеркало. Его отражение — чудовище. Не снаружи, а внутри. 'Что я делаю со своим сыном?' — впервые за столетия он задаёт себе этот вопрос. Изменения не придут мгновенно. Но осознание проблемы — первый шаг...",
    character: "Осознание",
    choices: [
      { text: "Хорошая концовка: Путь к исцелению", nextScene: 31 }
    ]
  },
  {
    id: 31,
    text: "Прошло несколько лет. Спайс всё ещё ревнив, всё ещё собственник. Но теперь он борется с этим. Капсаицин может видеться с учителями, гулять с друзьями. Иногда Спайс срывается, но каждый раз просит прощения и старается лучше. Это не идеальная семья. Но это семья, которая исцеляется. Вместе.",
    character: "ХОРОШАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 32,
    text: "Ревность Спайса превращается в ярость. Он разрушает всё — дворец, королевство, даже пустыню вокруг. Капсаицин смотрит на отца с ужасом. 'Отец, остановись!' Но слишком поздно. Великий разрушитель уничтожает всё, включая последний шанс на любовь. Когда ярость проходит, Спайс остаётся один среди руин...",
    character: "САМАЯ ПЛОХАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 33,
    text: "Капсаицин начинает повторять слова отца: 'Никому нельзя доверять. Только отец меня любит. Только отец не предаст.' Спайс триумфует — сын теперь думает так же, как он. Но это победа? Или трагедия? Два одиноких человека, запертые в тюрьме паранойи, которую они сами построили...",
    character: "ПЛОХАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 34,
    text: "Спайс теряет контроль. Он причиняет боль собственному сыну в порыве ревности. Когда он приходит в себя, Капсаицин лежит на полу, плачет. Спайс понимает — он стал именно тем монстром, которым его считают. Он разрушил не только королевства, но и единственную настоящую связь в своей жизни...",
    character: "САМАЯ ПЛОХАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 35,
    text: "Спайс останавливается. Его руки дрожат в сантиметрах от Капсаицина. 'Нет... Нет, не это...' Он отступает, его огромное тело сотрясается от рыданий. 'Я чуть не... Боги, что я делаю?' Капсаицин смотрит на отца — и видит не монстра, а сломленного человека...",
    character: "Момент осознания",
    choices: [
      { text: "Хорошая концовка: Путь к исцелению", nextScene: 31 },
      { text: "Отдалиться от отца навсегда", nextScene: 38 }
    ]
  },
  {
    id: 36,
    text: "'Отец, давай вместе найдём способ. Ты боишься потерять меня, а я боюсь потерять тебя в твоей ярости. Но мы можем найти баланс.' Спайс смотрит на сына — такого мудрого для своих лет. 'Ты... Ты готов помочь мне?' — 'Всегда, отец. Всегда.'",
    character: "Союз",
    choices: [
      { text: "Хорошая концовка: Путь к исцелению", nextScene: 31 }
    ]
  },
  {
    id: 37,
    text: "Спайс закрывает глаза. Слова сына эхом отдаются в его душе. Медленно, очень медленно, он кивает. 'Научи меня... Научи меня, как любить правильно.' Капсаицин обнимает отца. Это долгий путь. Тысячи лет боли не исчезнут за день. Но они идут по нему вместе. И это уже победа.",
    character: "ЛУЧШАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  },
  {
    id: 38,
    text: "Капсаицин понимает — он не может спасти отца. Он может только спасти себя. Однажды ночью он сбегает из дворца. Спайс находит пустую комнату и записку: 'Прости, отец. Я люблю тебя. Но я не могу жить в твоей клетке.' Великий разрушитель падает на колени. Он потерял единственное, что имело значение...",
    character: "ГОРЬКАЯ КОНЦОВКА",
    isEnding: true,
    choices: [
      { text: "Начать заново", nextScene: 0 }
    ]
  }
];

export default function Index() {
  const [currentScene, setCurrentScene] = useState(0);
  const [visitedScenes, setVisitedScenes] = useState<number[]>([0]);

  const scene = storyData[currentScene];

  const handleChoice = (nextScene: number) => {
    setCurrentScene(nextScene);
    if (!visitedScenes.includes(nextScene)) {
      setVisitedScenes([...visitedScenes, nextScene]);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-[#2D1B3D] via-[#3d2647] to-[#8B47B7] flex items-center justify-center p-4 font-sans">
      <div className="max-w-4xl w-full">
        <div className="text-center mb-8 animate-fade-in">
          <h1 className="text-5xl md:text-6xl font-serif text-white mb-2 text-shadow">
            Королевство в Пустыне
          </h1>
          <p className="text-[#8B4789] text-lg">
            Глава {visitedScenes.length} из {storyData.length}
          </p>
        </div>

        <Card className="bg-white/95 backdrop-blur p-8 md:p-12 rounded-2xl shadow-2xl animate-fade-in">
          {scene.character && (
            <div className="flex items-center gap-2 mb-6 text-primary/70">
              <Icon name="User" size={20} />
              <span className="font-semibold text-sm uppercase tracking-wider">
                {scene.character}
              </span>
            </div>
          )}

          <div className="prose prose-lg max-w-none mb-8">
            <p className="text-foreground leading-relaxed font-serif text-lg md:text-xl">
              {scene.text}
            </p>
          </div>

          <div className="space-y-3">
            {scene.choices.map((choice, index) => (
              <Button
                key={index}
                onClick={() => handleChoice(choice.nextScene)}
                className="w-full text-left justify-start h-auto py-4 px-6 bg-primary hover:bg-primary/90 text-primary-foreground rounded-xl text-base md:text-lg font-medium transition-all duration-200 hover:scale-[1.02] shadow-md"
              >
                <Icon name="ChevronRight" size={20} className="mr-2 flex-shrink-0" />
                <span>{choice.text}</span>
              </Button>
            ))}
          </div>

          {scene.isEnding && (
            <div className="mt-8 pt-8 border-t border-muted-foreground/20 text-center">
              <p className="text-muted-foreground italic">
                Продолжение следует...
              </p>
            </div>
          )}
        </Card>

        <div className="mt-6 flex justify-center gap-6 text-white/60 text-sm">
          <div className="flex items-center gap-2">
            <Icon name="BookOpen" size={16} />
            <span>Визуальная новелла</span>
          </div>
          <div className="flex items-center gap-2">
            <Icon name="Bookmark" size={16} />
            <span>{visitedScenes.length} посещено</span>
          </div>
        </div>
      </div>
    </div>
  );
}